<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Blog API - UI</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    form { margin-bottom: 20px; }
    input, textarea { width: 300px; margin: 5px 0; padding: 5px; }
    button { margin-right: 5px; }
    .post { border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>Blog Posts</h1>

  <form id="postForm">
    <input name="title" placeholder="Title" required /><br/>
    <textarea name="content" placeholder="Content" required></textarea><br/>
    <button type="submit">Create Post</button>
  </form>

  <h2>All Posts</h2>
  <div id="posts"></div>

<script>
async function loadPosts() {
  const res = await fetch('/posts');
  const data = await res.json();
  const container = document.getElementById('posts');
  container.innerHTML = '';
  data.forEach(p => {
    const div = document.createElement('div');
    div.className = 'post';
    div.innerHTML = `
      <h3>${escapeHtml(p.title)}</h3>
      <p>${escapeHtml(p.content)}</p>
      <button onclick="deletePost(${p.id})">Delete</button>
      <button onclick="showUpdateForm(${p.id}, '${escapeHtml(p.title)}', '${escapeHtml(p.content)}')">Update</button>
    `;
    container.appendChild(div);
  });
}

async function deletePost(id) {
  await fetch('/posts/' + id, { method: 'DELETE' });
  loadPosts();
}

function showUpdateForm(id, title, content) {
  const container = document.getElementById('posts');
  const formDiv = document.createElement('div');
  formDiv.className = 'post';
  formDiv.innerHTML = `
    <h3>Edit Post #${id}</h3>
    <form onsubmit="updatePost(event, ${id})">
      <input name="title" value="${title}" /><br/>
      <textarea name="content">${content}</textarea><br/>
      <button type="submit">Save</button>
      <button type="button" onclick="loadPosts()">Cancel</button>
    </form>
  `;
  container.innerHTML = '';
  container.appendChild(formDiv);
}

async function updatePost(e, id) {
  e.preventDefault();
  const form = e.target;
  const title = form.title.value.trim();
  const content = form.content.value.trim();
  await fetch('/posts/' + id, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ title, content })
  });
  loadPosts();
}

document.getElementById('postForm').onsubmit = async (e) => {
  e.preventDefault();
  const form = e.target;
  const title = form.title.value.trim();
  const content = form.content.value.trim();
  if (!title || !content) return alert('Fill both');
  await fetch('/posts', {
    method: 'POST',
    headers: { 'Content-Type':'application/json' },
    body: JSON.stringify({ title, content })
  });
  form.reset();
  loadPosts();
};

function escapeHtml(s) {
  return String(s).replace(/[&<>"']/g, (m) => ({
    '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
  }[m]));
}

loadPosts();
</script>
</body>
</html>
